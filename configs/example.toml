[project]
name = "wafer-surrogate-minimal"

[run]
mode = "train"
output_dir = "runs"
run_id = "example"

[data]
source = "synthetic"
num_runs = 2
num_steps = 6
grid_size = 24
dt = 0.1

[model]
name = "baseline"

[prior]
name = "gaussian_latent"
latent_dim = 2
mean = [0.0, 0.0]
std = [1.0, 1.0]

[pipeline]
stages = ["cleaning", "featurization", "preprocessing", "train", "inference"]

[cleaning]
remove_duplicates = true
fill_missing_recipe = true
fill_missing_recipe_value = 0.0
normalize_recipe = { enabled = true }

[featurization]
extractor = "identity"
extractor_kwargs = { prefix = "feat_" }
target_mode = "frame_mean_delta" # frame_mean_delta | vn_narrow_band
band_width = 0.5
min_grad_norm = 1e-6
nb_backend = "hdf5" # hdf5 | zarr | memory
emit_priv = false
priv_source = "auto" # auto | real | proxy

[preprocessing]
steps = ["identity"]
normalize = true

[train]
mode = "tabular" # tabular | sparse_distill
model_name = "baseline_vn_linear_trainable"
model_variants = ["baseline_vn_linear_trainable", "baseline_vn_linear"]
model_kwargs = { default_value = 0.0, learning_rate = 0.02, epochs = 120, l2 = 1e-6 }
teacher_model = "sparse_vn_teacher"
student_model = "sparse_vn_student"
distill_alpha = 0.5
distill_beta = 0.2
distill_gamma = 0.1
sparse_batch_points = 20000
sparse_model_profile = "small" # small | base | large
early_stopping_patience = 0
grad_clip_norm = 5.0
lr_scheduler = "none"
fallback_model = "baseline_vn_linear_trainable"

[inference]
mode = "single"
ood_threshold = 3.0
template_run_id = ""
reinit_enabled = false
reinit_every_n = 5
reinit_iters = 8
reinit_dt = 0.3

[inference.calibration]
enabled = false
method = "map" # map | sbi
sem_features = ""
latent_dim = 16
num_posterior_samples = 32

[visualization]

[visualization.defaults]
enabled = true

[visualization.train]
learning_curves = true
scatter_gt_pred = true
r2 = true

[visualization.inference]
temporal_diagnostics_plot = true

[visualization.sdf_views]
xy = true
xz = true
yz = true
gt_pred_error = true

[visualization.mesh3d]
html = true
cutaway = true
compare_t8 = true

[visualization.export]
dpi = 140
max_frames = "all"
